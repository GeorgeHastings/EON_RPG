"use strict";var UI={colors:{none:"#939DBD",common:"#fff",rare:"#4D75CE",epic:"#9E65C4",legendary:"#C6AF66",entity:"#fff",player:"#fff",enemy:"#fff",gold:"#E5CA48",red:"#ff6839"},narrative:{el:document.getElementById("narrative"),getMomentByClick:function(){var e=this.getAttribute("data-moment");GameState.setCurrentMoment(Moments["moment"+e])},renderShopItem:function(e){var t=getObj(Items,e),i=document.createElement("a"),r=document.createTextNode(t.name);i.setAttribute("data-item",t.name),i.appendChild(r),UI.narrative.el.appendChild(i),i.onclick=Player.purchaseItem},renderShop:function(){var e=GameState.currentMoment.shop;forEach(e,UI.narrative.renderShopItem),bindToMany("#inventory [data-item]","onclick",Player.sellItem),UI.itemDescription.bindItemDescriptionEvents()},renderChoice:function(e){var t=document.createElement("a"),i=document.createTextNode(e.message);t.setAttribute("data-moment",e.link),t.appendChild(i),t.onclick=UI.narrative.getMomentByClick,UI.narrative.el.appendChild(t)},renderChoices:function(){var e=GameState.currentMoment.choices;forEach(e,UI.narrative.renderChoice)},renderMoment:function(){var e=document.createElement("p"),t=document.createTextNode(GameState.currentMoment.message);e.appendChild(t),UI.narrative.el.appendChild(e)}},statlist:{el:document.getElementById("stat-list"),renderStats:function(){for(var e=this.el.querySelectorAll("div"),t=0;t<e.length;t++){var i=e[t].parentNode.getAttribute("data-stat");e[t].innerHTML=Player[i]}}},inventory:{el:document.getElementById("inventory"),gold:document.getElementById("gold"),renderInventory:function(){this.el.innerHTML="";for(var e=0;e<Player.inventory.length;e++){var t=Player.inventory[e],i=document.createElement("li"),r=document.createTextNode(t.name),n=GameState.currentMoment.hasOwnProperty("shop"),o="armor"===t.itemType&&t===Player.equippedArmor[t.slot];i.appendChild(r),i.setAttribute("data-item",t.name),this.el.appendChild(i),n?GameState.bindShopItemEvents():GameState.bindWorldItemEvents(),t===Player.equippedWeapon&&this.renderEquippedWeapon(i),o&&i.classList.add("equipped-armor")}UI.itemDescription.bindItemDescriptionEvents()},renderGold:function(){UI.inventory.gold.innerHTML=Player.gold},removeEquippedWepTag:function(){var e=document.querySelector(".equipped-wep");e&&e.classList.remove("equipped-wep")},removeEquippedArmorTag:function(){for(var e=document.querySelectorAll(".equipped-armor"),t=0;t<e.length;t++)e[t].classList.remove("equipped-armor")},renderEquippedWeapon:function(e){this.removeEquippedWepTag(),e.classList.add("equipped-wep")},renderEquippedArmor:function(){this.removeEquippedArmorTag();for(var e in Player.equippedArmor)Player.equippedArmor[e].name&&UI.inventory.el.querySelector('[data-item="'+Player.equippedArmor[e].name+'"').classList.add("equipped-armor")},activateItem:function(){var e=this.getAttribute("data-item"),t=getObj(Items,e),i="weapon"===t.itemType&&Player.equippedWeapon!==t,r="armor"===t.itemType&&t!==Player.equippedArmor[t.slot];i&&(Player.equipWeapon(t),UI.inventory.renderEquippedWeapon(this),t.use()),r&&(Player.equipArmor(t),UI.inventory.renderEquippedArmor(),t.use()),"consumable"===t.itemType&&(Player.removeFromInventory(e),UI.itemDescription.hideItemDescription(),UI.inventory.renderInventory(),t.use()),"quest"===t.itemType&&t.use()}},itemDescription:{el:document.getElementById("itemDescription"),items:document.getElementById("descItems"),initialX:0,initialY:0,getInitialY:function(e){var t=e.pageY;return UI.itemDescription.intialY=t,t},getInitialX:function(e){var t=e.pageX;return UI.itemDescription.intialX=t,t},position:function(e){var t=UI.itemDescription,i=window.innerWidth,r=window.innerHeight,n=t.getInitialX(e),o=t.getInitialY(e),a="translate3d("+n+"px,"+o+"px, 0)";e.pageX+(t.el.offsetWidth+10)>i?t.el.style.left=t.initialX-t.el.offsetWidth-10+"px":t.el.style.left=t.initialX+10+"px",e.pageY+(t.el.offsetHeight+10)>r?t.el.style.top=t.initialY-t.el.offsetHeight-10+"px":UI.itemDescription.el.style.top=t.initialY+10+"px",t.el.style.webkitTransform=a,t.el.style.transform=a},showItemDescription:function(){UI.itemDescription.el.style.display="block"},hideItemDescription:function(){UI.itemDescription.el.style.display="none"},createEl:function(e,t){var i=document.createElement("div"),r=document.createTextNode(e);return i.classList.add(t),i.appendChild(r),i},renderItemDescription:function(){UI.itemDescription.items.innerHTML="";var e=this.getAttribute("data-item"),t=getObj(Items,e),i;for(var r in t)if("function"!=typeof t[r]){if(i="damage"===r?UI.itemDescription.createEl(t[r][0]+"-"+t[r][1],""+r):UI.itemDescription.createEl(t[r],""+r),"effect"===r){i=UI.itemDescription.createEl(t[r].description,""+r);for(var n=0;n<t.effect.length;n++)i=UI.itemDescription.createEl(t[r][n].description,""+r),UI.itemDescription.items.appendChild(i)}"rarity"===r&&(document.querySelector(".name").style.color=UI.colors[t[r]]),"flavorText"===r&&""===t[r]||UI.itemDescription.items.appendChild(i)}else if("getSalePrice"===r&&this.parentNode===UI.inventory.el){if(i=UI.itemDescription.createEl(t[r](),""+r),UI.itemDescription.items.appendChild(i),GameState.currentMoment.hasOwnProperty("shop")){var o=UI.itemDescription.createEl("(Click to sell)","shop-item");UI.itemDescription.items.appendChild(o)}}else if("getPurchasePrice"===r&&this.parentNode===UI.narrative.el&&(i=UI.itemDescription.createEl(t[r](),""+r),UI.itemDescription.items.appendChild(i),GameState.currentMoment.hasOwnProperty("shop"))){var a=UI.itemDescription.createEl("(Click to buy)","shop-item");UI.itemDescription.items.appendChild(a)}UI.itemDescription.showItemDescription()},getStatDescriptions:{level:function(){return"You have "+Player.experience+" points. You need "+(Player.calcNexLevelExp()-Player.experience)+" to reach the next level."},health:function(){return"You have "+(Player.healthTotal/Player.healthMax*100).toFixed(0)+"% health"},armor:function(){return"Reduces damage taken to "+(100*Player.damageReduction).toFixed(2)+"%"},quickness:function(){return""+Player.quicknessProc+"% chance to critical hit and dodge"},damage:function(){var e=(Player.equippedWeapon.damage[0]+Player.equippedWeapon.damage[1])/2,t=e+Player.quicknessProc/100*e;if(Player.equippedWeapon.effect&&"ItemProc"===Player.equippedWeapon.effect.constructor.name){var i=Player.equippedWeapon.effect.chance/100,r=Player.equippedWeapon.effect.amt;t+=i*r}return""+t.toFixed(2)+" average total damage per hit"},toughness:function(){return"Increases armor and max health by "+Player.toughness}},renderStatDescription:function(){var e=this.getAttribute("data-stat"),t=UI.itemDescription.getStatDescriptions[e](),i=UI.itemDescription.createEl(t,"stat");UI.itemDescription.items.innerHTML="",UI.itemDescription.items.appendChild(i),UI.itemDescription.showItemDescription()},bindItemDescriptionEvents:function(){bindToMany("[data-item], [data-stat]","onmouseenter",this.renderItemDescription),bindToMany("[data-item], [data-stat]","onmousemove",this.position),bindToMany("[data-item], [data-stat]","onmouseleave",this.hideItemDescription)}},combatLog:{el:document.getElementById("combatLog"),renderCombatLog:function(e){var t=document.createElement("p");t.innerHTML=e,this.el.appendChild(t),UI.scrollToBottom(UI.combatLog.el)},renderItemTransaction:function(e,t,i){this.renderCombatLog(colorize("You",UI.colors.player)+" "+i+" "+e+" for "+colorize(t+" gold",UI.colors.gold)+".")},renderCannotPurchaseMessage:function(e,t){this.renderCombatLog(colorize("You",UI.colors.player)+" need "+colorize(t-Player.gold+" gold",UI.colors.gold)+" to buy "+e+".")},renderLootMessage:function(){var e=GameState.currentMoment,t=e.dropLoot,i,r,n;if(i=e.enemy?" defeated "+colorize(e.enemy,"#fff"):"",t.length>0)if(r=" found",1===t.length){var o=getObj(Items,t[0]);r+=" "+colorize(t,UI.colors[o.rarity])}else for(var a=0;a<t.length;a++){var o=getObj(Items,t[a]);r+=a<t.length-1?" "+colorize(t[a],UI.colors[o.rarity])+",":" and "+colorize(t[a],UI.colors[o.rarity])}else r="";n=e.enemy&&t.length>0?" and":"",this.renderCombatLog(colorize("You",UI.colors.player)+i+n+r+".")}},scrollToBottom:function(e){e.scrollTop=e.scrollHeight}};